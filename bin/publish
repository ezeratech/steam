#!/usr/bin/env ruby

# bin/publish 0.0.1

class Publish

  def start version, rvm=false
    system "rvm use #{rvm}"

    system "bundle && bundle exec rspec"
    system "gem build steam.gemspec"
    system "git tag -a v#{version} -m 'version #{version}'"
    system "git push --tags"
    system "gem push steam-#{version}.gem"
    system "git push origin master"
  end

end

if ARGV.length != 1 # or !ARGV[0].match(/\d{1,3}.\d{1,3}.\d{1,3}/)
  puts 'HELP: '
  puts '$ bin/publish 0.0.1 ruby-2.1.1@steam'
  exit 0
end

Publish.new.start ARGV[0]